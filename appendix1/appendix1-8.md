## レイヤにスタイルを設定する

QGISでは、レイヤーにスタイルを適用することで要素の表示方法を設定することができます。以下では、ラスタレイヤとベクタレイヤそれぞれのスタイル設定方法について説明します。

レイヤーのスタイル設定は、左側のレイヤーリストからスタイルの設定を行いたいレイヤーを右クリックし、表示されるポップアップメニューの中から【プロパティ】を選択します。

![レイヤメニュー](img/appendix1-8-1.png)

### ラスタレイヤのスタイル設定

ラスタレイヤーのスタイル設定画面は「バンド表示」の設定項目はレンダータイプによって異なりますが、「カラーレンダリング」、「リサンプリング」の設定項目は共通です。

#### 単バンドグレー

![ラスタレイヤ単バンドグレープロパティ](img/appendix1-8-2.png)

単バンド画像をグレースケールで表示する場合のスタイルの設定を行います。各項目の説明は以下の通りです。

 - グレーバンド

　　単バンドなので、バンド１のみが選択可能です。

 - 色階調

　　[黒から白]、または[白から黒]を選択できます。[黒から白]を選択した場合は、ピクセル値が低い方から高いほうになるにつれて黒から白を割り当てます。

 - 最少／最大

  ピクセル値の最大値、最小値を指定します。後述する「読み込み」ボタンで画像のピクセル値を読み込んで値を設定することができます。また、ユーザがそれぞれの値を指定することもできます。

 - コントラスト拡張

　　表示時のコントラストの拡張方法を指定します。[無し]を指定するとコントラストの拡張を行いません。[最少最大に引き延ばす]を選択した場合は、指定した最小値／最大値にそれぞれ黒と白（またはその逆）を割り当てます。

 - 最少値／最大値のロード

　　ラスタレイヤからどのようにして最小値、最大値を読み込むかの方法を指定します。
　　[累積カウント数でのカット範囲]を選択した場合は、指定したパーセンテージの範囲での最小値、最大値を読み込みます。[最少/最大]は全体の最小値、最大値を読み込みます。[平均+/-標準偏差X]を選択した場合は、平均値±（標準偏差×指定した値）の範囲の値を読み込みます。

  「範囲」で全体を指定した場合はレイヤー全体を対象にし、現在の設定を指定した場合は現在の表示範囲が対象になります。また、「精度」で高速を指定した場合は現在表示されている画像からの推定値を、実際の値を指定した場合は画像をスキャンして最少／最大値を読み取ります。この処理は「読み込み」ボタンを押すと実行されます。

![グレースケール画像の設定例](img/appendix1-8-3.png)

SRTM標高画像の設定例


#### マルチバンドカラー

![ラスタレイヤマルチバンドカラープロパティ](img/appendix1-8-4.png)

マルチバンドカラー画像の場合のスタイル設定項目は以下の通りです。

 - Redバンド、Greenバンド、Blueバンド

  どのバンドをどの色に割り当てるかを指定します。

 - コントラスト強調

　　単バンドグレーの設定における「コントラストの拡張」と同じです。

 最小値／最大値のロードは単バンドグレーのものと同じです。

#### 単バンド疑似カラー

単バンド疑似カラーとは、単バンドの画像にグレースケール以外のカラーテーブルを割り当てて疑似的にカラー画像として表示するものです。熱センサ画像などでよく利用されています。

単バンド疑似カラーの設定画面は以下の通りです。

![疑似カラー画像設定画面](img/appendix1-8-5.png)

右側の「新規カラーマップを作製」で適用するカラーテーブルとモード（連続または等間隔）、モードで等間隔を選択した場合は分割数、および適用範囲となる最小／最大値を指定し、〔分類〕ボタンを押すと左側に色と適用される値の組が表示されます。
左側のカラーテーブルの値と色とラベルは個別に変更することができます。また、カラーテーブルは保存／読み込みが可能です。

〔色の補間〕は、”線形”ならば各値の色の間を線形で補間します。

![疑似カラー画像線形補間](img/appendix1-8-6.png)

〔色の補間〕で”離散的”を選択した場合は各値の間を補間せず、すべて同じ色に設定するので、適用結果は段彩図のようになります。

![疑似カラー画像離散的](img/appendix1-8-7.png)

〔色の補間〕で”厳密”を選択した場合は、カラーテーブルはその色に対応した値と一致しているピクセルにしか彩色されません。これは特定の値のピクセルを抽出したいときに有効です。
下の例はSRTM画像に対して、〔色の補間〕で”厳密”を選択し、値が0.0の箇所を抽出した例です。

![疑似カラー画像厳密](img/appendix1-8-8.png)

#### パレットカラー

パレットカラーは、通常は対象となるラスタレイヤがカラーパレットを持つ場合に使用します。カラーパレットとは番号ごとに色が決められているカラーテーブルのことで、このようなカラーパレットをファイル内に持っている画像の色モードをインデックスカラーモードと呼びます。この場合各ピクセル値にはカラーテーブルの番号が記録されます。GISでは、土地利用図などの主題図で用いると便利です。

QGISでインデックスカラー画像を読み込み、スタイルプロパティのレンダータイプで「パレットカラー」を選択すると、下図のようにファイル内のカラーテーブルが読み込まれます。

![パレットカラープロパティ](img/appendix1-8-9.png)

値に対応する色は個別に設定することができます。

下図は土地被覆分類結果画像にパレットカラーを適用した例です。

![パレットカラー適用例](img/appendix1-8-10.png)


####　共通項目

カラーレンダリングはレイヤの描画についての設定を行います。〔混合モード〕は下のレイヤーの色との混合方法を指定します。”通常”の場合は下のレイヤーとは無関係に描画しますが、それ以外では下のレイヤーとの演算で描画します。
そのほか、明度、彩度、色相の調節、コントラストの協調、強調色の指定などを行うことができます。

リサンプリングは、拡大／縮小時のピクセル内挿法を指定します。QGISでは、縮小画像の描画時にすべてのピクセルを描画しているわけではありません。また、かなり拡大した時は画像のピクセルがキャンバスの解像度を下回るため、ピクセルの矩形が見えるようになります。この時にリサンプリング法で最近傍以外を指定することで滑らかに描画するように設定することができます。
オーバーサンプリングの値は元画像に対する倍率で、たとえば0.1を指定すると元の画像サイズの0.1倍を基準としてリサンプルを行います。

### ベクタレイヤのスタイル設定

ベクタレイヤのスタイル設定は複雑ですがそれだけ柔軟な設定が可能です。描画要素の設定に加え、ベクタレイヤののフィールドに応じたシンボルの設定やラベル、グラフの表示を行うことができます。データのビジュアライゼーションのキモとなる部分です。

#### シンボルとマーカー

ベクタレイヤの図形はシンボルによって描画されます。
シンボルを編集するには、シンボルレイヤ群のツリー要素を選択し、表示される右側のパネルから各設定を行います。

![シンボルプロパティ](img/appendix1-8-11.png)

シンボルは１つまたは複数のシンボルレイヤと呼ばれるレイヤから成り立っており、各レイヤにはマーカーと呼ばれる要素が配置されます。複数のシンボルレイヤを重ねることで、より複雑なシンボルを作成することができます。たとえば、「star2」というシンボルは２つのシンボルレイヤからできています。

![star2シンボル](img/appendix1-8-12.png)

シンボルレイヤはシンボルレイヤツリーの下にあるプラス／マイナスボタンで追加／削除を行うことができます。また、シンボルレイヤレイヤの順序を操作することで全面／背面への移動を行うことができ舞うs。

シンボルに含まれるシンボルレイヤのマーカーを編集するには、シンボルレイヤツリーから編集したいシンボルレイヤを選択します。

![マーカー編集画面](img/appendix1-8-13.png)

上の図はポイントレイヤに対するシンプルマーカーと呼ばれるマーカーで、あらかじめ定義されている単純図形のマーカーです。シンプルマーカーでは塗りつぶしや枠線の色、枠線の幅などを設定することができます。

シンボルレイヤタイプはベクタレイヤの要素種別によって異なります。点レイヤの場合はシンプルマーカーの他に楕円マーカー、フォントマーカー、SVGマーカー、ベクタフィールドマーカーのシンボルレイヤタイプがあります。線レイヤの場合はシンプルラインとマーカーラインの２種類のシンボルレイヤタイプがあります。ポリゴンの場合はシンプル塗りつぶしのほかに多数のシンボルレイヤタイプがあります。以下に各シンボルレイヤタイプの説明を示します。

まず、点レイヤに対するシンボルレイヤタイプは以下の通りです。

- 楕円マーカー

楕円マーカーはマーカーの幅と高さを別個に指定できるマーカーです。

![楕円マーカー設定画面](img/appendix1-8-14.png)

 - フォントマーカー

フォントマーカーは文字をマーカーとして使用するものです。

![フォントマーカー設定画面](img/appendix1-8-15.png)

 - SVGマーカー

SVGマーカーはSVGファイルをマーカーとして使用するもので、複雑なマーカーを作成することができます。QGISにあらかじめ用意されているものが多数あるほか、ユーザがSVGファイルを作成して登録することもできます。

![SVGマーカー設定画面](img/appendix1-8-16.png)

 - ベクタフィールドマーカー

ベクタフィールドマーカーはベクタレイヤの属性値を長さや角度に反映させるラインマーカーです。使用されるラインマーカーはシンプルマーカーと同様に設定することができます。

![ベクタフィールドマーカー設定画面](img/appendix1-8-17.png)

線レイヤに対するマーカーは、シンプルラインとマーカーラインの２種類があります。複数のシンボルレイヤを活用して複線を定義することもできます。

 - シンプルライン

シンプルラインマーカーは色、線種、線幅などの線属性のほか、頂点部分の接続形態を定義することができます。

![シンプルラインマーカー設定画面](img/appendix1-8-18.png)

 - マーカーライン

マーカーラインとは線を構成するポイントマーカーを指定するものです。ポイントマーカーは点レイヤのものと同じです。マーカーの間隔と回転を定義することができます。

![マーカーラインマーカー設定画面](img/appendix1-8-19.png)

ポリゴンに対するマーカーは多数ありますが、大きく分けて塗りつぶしありと無しの２種類があり、塗りつぶしの方法によってマーカーが異なります。まず塗りつぶしを行うタイプのマーカーを列挙します。

 - シンプル塗りつぶし

要素を単色で塗りつぶすマーカーです。塗りつぶしの色のほか、斜線や横線などの簡単なハッチを指定することもできます。また、枠線の種類も指定することができます。枠線の種類はシンプルラインマーカーのものと同じです。

![シンプル塗りつぶしマーカー設定画面](img/appendix1-8-20.png)

 - 中心点塗りつぶし

これはポリゴンの中心点にポイントマーカーを配置するというものです。ポリゴンの枠線などは描画されません。配置するポイントマーカーの種類は点レイヤのものと同じです。

![中心点塗りつぶしマーカー](img/appendix1-8-21.png)

 - 階調塗りつぶし

グラデーション塗りつぶしを行うマーカーです。２つの色を指定するか、またはカラーランプを指定することができます（カラーランプについては後述）。グラデーションの方向、角度、繰り返し等の細かい設定が可能です。

![階調塗りつぶし](img/appendix1-8-22.png)

 - ラインパターン塗りつぶし

ポリゴンの内部をラインでハッチをかけるシンボルレイヤタイプです。シンプル塗りつぶしマーカーと異なり、ラインマーカーを別途指定することができるので、マーカーラインで塗りつぶすことが可能です。枠線は描画されません。

![ラインパターン塗りつぶし](img/appendix1-8-23.png)

 - ポイントパターン塗りつぶし

ラインパターン塗りつぶしと同様にポイントマーカーでポリゴン内を描画します。ポイントマーカーを別途指定することで複雑な図形で塗りつぶすことが可能です。ポイントパターン塗りつぶしの場合も、枠線は描画されません。

![ポイントパターン塗りつぶし](img/appendix1-8-24.png)

 - SVG塗りつぶし

ポリゴン内をSVGマーカーで塗りつぶし、同時に枠線を定義することができるシンボルレイヤタイプです。塗りつぶしに使用するSVGシンボルと、枠線のラインマーカーを同時に指定することができます。

![SVG塗りつぶし](img/appendix1-8-25.png)

以下に挙げる２つのマーカーは塗りつぶしを行わないタイプのマーカーです。

 - アウトラインマーカーライン

マーカーラインで枠線を描画するシンボルレイヤタイプです。枠線の指定はマーカーラインマーカーと同じです。

![アウトラインマーカーライン](img/appendix1-8-26.png)

 - アウトラインシンプルライン

枠線をシンプルラインマーカーで描画するシンボルレイヤタイプです。シンプル塗りつぶしで塗りつぶしタイプに”ブラシなし”を指定した場合と同じです。

![アウトラインシンプルライン](img/appendix1-8-27.png)

### 描画モード

ベクタレイヤ内の各要素を描画するときに、すべて同じシンボルで描画するか、または各要素の属性に応じて描画を分けるかなどの設定を行うことができます。以下に、各描画モードについて説明します。

#### 「共通シンボル」

レイヤのすべての要素を同じシンボルで描画します。下の画像は点レイヤに対する共通シンボル設定画面です。


#### 「分類された」

このモードではフィールドの値をもとに各要素を分類し、分類クラスごとにシンボルを割り当てます。「分類された」を選択すると、以下のような設定画面が表示されます。

![分類モード](img/appendix1-8-28.png)

〔カラム〕で分類に使用するフィールドを指定するか、その右側にある『ε』ボタンを押してフィールドに対する数式を入力することで分類を行います。図の例ではフィールドの先頭文字によって要素を分類します。分類を実行するにはシンボルリストの下にある『分類』ボタンを押します。

#### 段階に分けられた

このモードでは、数値型のフィールドに対して段階分けを行い、各段階にそれぞれシンボルを割り当てます。数値型フィールドを持たないベクタレイヤでは使用することができません。

![段階分けモード](img/appendix1-8-29.png)

「分類された」のときと同じように段階分けに使用するカラムを選択するか、もしくは数式を入力します。カラム選択の右側にある「分類数」の項目で、何段階に分けるかの段階数を指定します。設定が完了したらシンボルリストの下にある『分類』ボタンを押して段階分けを実行します。

#### ルールに基づいた

このモードではユーザがルールを一つ一つ定義していきます。

![ルールモード](img/appendix1-8-30.png)

このモードを選択した時にはルールはまだ一つもない状態です。ルールを追加するには下の『＋』ボタンを押します。

![ルールプロパティ](img/appendix1-8-31.png)

フィルタの項目で条件を指定します。横の『...』ボタンを押すと数式ビルダが起動するので、フィルタに利用する式を作成することができます。『テスト』ボタンを押すと条件に該当する地物をカウントします。

ルールは上から適用されるので、両方の条件に該当する地物がある場合は最終的には下のルールが適用されます。

#### 点の移動

「点の移動」モードは点のベクタレイヤのみに対して適用することができます。

![点の移動モード](img/appendix1-8-32.png)

このモードでは点のレンダリングを一括して設定することができます。「レンダラ」では上記のモードを選択します。

### レイヤレンダリング

レイヤレンダリングの項目ではレイヤの透過性や混合モードなどを設定します。混合モードにはレイヤ混合モードと地物混合モードの両方を設定することができます。レイヤ混合モードはレイヤ間の混合モードを指定し、地物混合モードは同一レイヤ内の地物間での混合モードを指定します。
それぞれの混合モードはラスタレイヤのものと同じです。

### フィールド値と回転、スケール

数値型のフィールドをシンボルの回転角およびスケールに適用することができます。フィールド値をスタイルに適用するには、右下にある『アドバンスト』ボタンを押し、表示されるメニューからフィールドを選択するか式を入力します。

![アドバンストメニュー](img/appendix1-8-33.png)

### スタイルマネージャ

スタイルマネージャは登録されているマーカーやハッチ、カラーランプなどの編集を行うものです。スタイルマネージャを表示するには、描画モードが共通シンボルの場合は『シンボル』ボタンを押して表示されるメニューから【スタイルマネージャ】を選択します。

![スタイルマネージャの起動](img/appendix1-8-34.png)

それ以外のモードの場合はそれぞれのシンボルをダブルクリックし、表示されるシンボルセレクタダイアログに『シンボル』ボタンがあります。

![スタイルマネージャの起動](img/appendix1-8-35.png)

スタイルマネージャのダイアログにはマーカー、ライン、塗りつぶし、カラーランプのタブがあります。それぞれの設定項目は以下の通りです。

 - 〔マーカー〕タブ

![マーカータブ](img/appendix1-8-36.png)

ポイントマーカーやマーカーラインで使用されるマーカーのスタイルを編集します。追加、または編集ボタンを押すとシンボルセレクタのダイアログが表示されるので、マーカーの編集と同じようにスタイルを作成することができます。

 - 〔ライン〕タブ

![ラインタブ](img/appendix1-8-37.png)

ラインマーカーやポリゴンの枠線などに使用するラインのスタイルを編集します。

 - 〔塗りつぶし〕タブ

![塗りつぶしタブ](img/appendix1-8-38.png)

ポリゴンに対する塗りつぶしパターンを編集します。

 - 〔カラーランプ〕タブ

![カラーランプタブ](img/appendix1-8-39.png)

カラーランプはグラデーション塗りつぶし、ベクタレイヤの段階分け、ラスタレイヤの疑似カラーなどに使用されるカラーテーブルのことです。カラーランプの追加ボタンを押すと、いくつかのメニューが表示されます。

![カラーランプ追加メニュー](img/appendix1-8-40.png)

カラーランプの編集は追加時に選択したメニューによって異なります。【階調】を選択した場合は以下のダイアログが表示されます。

![階調カラーランプ](img/appendix1-8-41.png)

「タイプ」はグラデーションで色が変化する"連続的"と、段階的に色が変化する"離散的"の２種類があります。『終わりの追加』ボタンで中間に色を追加することができます。
ランダムカラーは開始と終了の色相、彩度、明度を指定し、分類数で色数を指定します。

![ランダムカラーランプ](img/appendix1-8-42.png)

カラーブリューワは多数の定義済みカラーテーブルから選択して、色数をを指定します。

![カラーブリューワ](img/appendix1-8-43.png)

cpt-cityとはMichael Galloy氏が作成しているIDLライブラリで使用されるカラーテーブル集です。オリジナルのカラーテーブル集は http://docs.idldev.com/mglib/vis/color/cptcity_catalog.html　で見ることができます。

![cpt-cityカラーテーブル](img/appendix1-8-44.png)

【cpt-city】メニューを選択すると以下のようなダイアログが表示されます。各カラーテーブルはカテゴリに分けられており、左側のツリーからカテゴリを選択することができます。

![cpt-cityカラーテーブルダイアログ](img/appendix1-8-45.png)

### ラベル



### グラフ



### スタイルの読み込み／保存
